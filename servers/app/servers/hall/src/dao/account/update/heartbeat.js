////////////////////////////////////////////////////////////////////////////////
// Account Update Heartbeat
// 心跳更新(每日凌晨重置为0)
// update
////////////////////////////////////////////////////////////////////////////////

//==============================================================================
// import
//==============================================================================
var AccountCommon = require('../common');
var CacheAccount = require('../../../buzz/cache/CacheAccount');


//==============================================================================
// const
//==============================================================================
var DEBUG = 0;
var ERROR = 1;


//==============================================================================
// public
//==============================================================================

//------------------------------------------------------------------------------
// definition
//------------------------------------------------------------------------------
exports.update = _update;

//------------------------------------------------------------------------------
// implement
//------------------------------------------------------------------------------

/**
 * 账户数据更新(每日任务完成度).
 */
function _update(pool, data, cb, my_account) {
    if (DEBUG) console.log("CALL heartbeat.update()");
    
    var account_id = my_account['id'];
    var token = my_account['token'];
        
    var heartbeat = data['heartbeat'];
    var heartbeat_min_cost = data['heartbeat_min_cost'];

    if (heartbeat == null) {
        heartbeat = 1;
    }

    if (heartbeat_min_cost == null) {
        heartbeat_min_cost = 0;
    }
    
    //--------------------------------------------------------------------------
    // 更新缓存中的数据(重要:数据库操作将会被删除)
    //--------------------------------------------------------------------------
    CacheAccount.setHeartbeat(account_id, heartbeat);
    CacheAccount.setHeartbeatMinCost(account_id, heartbeat_min_cost);
    //--------------------------------------------------------------------------

    cb(null, "success");
}


//==============================================================================
// private
//==============================================================================
